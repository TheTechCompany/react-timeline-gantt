var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(t,s,o)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o,r=(e,t)=>{for(var s in t||(t={}))i.call(t,s)&&a(e,s,t[s]);if(o)for(var s of o(t))n.call(t,s)&&a(e,s,t[s]);return e},l=(e,o)=>t(e,s(o));import{q as d,r as h,R as c,C as p,a as u,h as m,B as g,d as f,n as k,b as w}from"./vendor.3cb1642e.js";const y={header:{top:{style:{backgroundColor:"#333333",fontSize:10,color:"white",textAlign:"center"}},middle:{style:{backgroundColor:"chocolate"},selectedStyle:{backgroundColor:"#b13525",fontWeight:"bold"}},bottom:{style:{background:"#f3f4f5",color:"#667280",fontSize:".9em"},selectedStyle:{backgroundColor:"#b13525",fontWeight:"bold"}}},taskList:{title:{label:"Projects",style:{backgroundColor:"#333333",borderBottom:"solid 1px silver",color:"white",textAlign:"center"}},task:{style:{backgroundColor:"#fbf9f9"}},verticalSeparator:{style:{backgroundColor:"#333333"},grip:{style:{backgroundColor:"#cfcfcd"}}}},dataViewPort:{rows:{style:{}},task:{showLabel:!1,style:{position:"absolute",borderRadius:14,color:"white",textAlign:"center",backgroundColor:"grey"},selectedStyle:{position:"absolute",borderRadius:14,border:"solid 1px #ff00fa",color:"white",textAlign:"center",backgroundColor:"grey"}}},links:{color:"black",selectedColor:"#ff00fa"}};const v=new class{constructor(){this.load=e=>{this.data={},e?this.populate(e,y,this.data):this.data=y},this.data=y}populate(e,t,s){if(this.isObject(t))for(let o in t)e[o]?(s[o]=e[o],this.populate(e[o],t[o],s[o])):s[o]=t[o]}isObject(e){return"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e}get values(){return this.data}};var x=d((e=>{const t=h.exports.useRef(null),s=h.exports.useRef(!1),[o,i]=h.exports.useState(!1),n=e=>{s.current=e,i(e)},a=h.exports.useRef(0),r=t=>{var o;if(s.current){t.stopPropagation(),console.log("MOUSEMOVE",t);let s=(a.current||0)-t.clientX;a.current=t.clientX,s>0&&console.log("delta",s),null==(o=e.onTaskListSizing)||o.call(e,t.clientX+6)}};return console.log("Dragging",s.current),c.createElement("div",{ref:t,className:`${e.className} ${1==o?"dragging":""}`,style:v.values.taskList.verticalSeparator.style,onMouseDown:e=>{if(0===e.button){console.log("MOUSE DOWN"),a.current=e.clientX,n(!0);const t=()=>{console.log("CLEANUP"),n(!1),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",t)};window.addEventListener("mousemove",r),window.addEventListener("mouseup",t)}}},c.createElement(p,null),c.createElement(u,null))}))`
  width: 5px;
  transition: width 100ms ease-out;
  cursor: col-resize;

  align-items: center;
  justify-content: center;
  display: flex;
  flex-direction: column;

  & svg{
    transition opacity 100ms ease-out;
  }
  &:not(:hover) svg{
    opacity: 0;
  }

  &:hover svg{
    opacity: 1;
  }

  &:hover{
    width: 13px;
  }
  &.dragging{
    width: 13px;
  }
`;const E=new class{constructor(){this.dayToPosition=(e,t,s)=>e*s+t,this.daysInYear=e=>this.isLeapYear(e)?366:365}dateToPixel(e,t,s){let o=this.getToday(),i=new Date(e),n=60*(i.getTimezoneOffset()-o.getTimezoneOffset())*1e3;return(i.getTime()-o.getTime()-n)/36e5*(s/24)+t}pixelToDate(e,t,s){let o=24/s,i=e-t,n=this.getToday(),a=n.getTime()+i*o*36e5,r=new Date(a),l=60*(r.getTimezoneOffset()-n.getTimezoneOffset())*1e3;return r.setTime(r.getTime()+l),r}getToday(){let e=new Date;return e.setHours(0,0,0,0),e}monthDiff(e,t){return Math.abs(t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear()))}daysInMonth(e,t){return new Date(t,e,0).getDate()}isLeapYear(e){return e%400==0||e%100!=0&&e%4==0}};const S=d((e=>c.createElement("div",{className:e.className,style:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:"solid 1px rgb(216, 217, 218)",position:"absolute",height:20,left:e.left,width:e.width,cursor:"pointer"}},c.createElement("div",null,e.label))))`
  
    &:hover{
        background: rgba(127, 127, 127, 0.3);
    }
  `,b=c.createContext({}),C=e=>c.createElement("div",{style:{position:"absolute",background:e.background,left:e.left,height:"100%",width:`${e.width}px`}}),T=e=>{const t=h.exports.useRef(null),{mode:s,dayWidth:o}=h.exports.useContext(b),i=(e,t)=>{switch(e){case"year":return"YYYY";case"month":return"top"==t?"MMMM YYYY":"MMMM";case"week":return"top"==t?"ww MMMM YYYY":"ww";case"dayweek":return"dd";case"daymonth":return"D"}},n=(e,t,s,o)=>{let i=[],n=t/24,a=0;for(let r=0;r<24;r++)i.push(c.createElement(S,{key:r,left:a,width:n,label:"shorttime"==s?r:`${r}:00`})),a+=n;return c.createElement("div",{key:o,style:{position:"absolute",height:20,left:e,width:t}}," ",i)},a=(t,s,i=0)=>{let n=((e,t)=>{switch(t){case"year":return E.daysInYear(e.year());case"month":return e.daysInMonth();case"week":return 7;default:return 1}})(t,s)*(o||0);if(!i){let n=((e,t)=>{let s=null;switch(t){case"year":return s=e.year(),m([s,0,1]);case"month":s=e.year();let t=e.month();return m([s,t,1]);case"week":return e.clone().startOf("week");default:return e}})(t,s);n=n.startOf("day");let a=m().startOf("day"),r=n.diff(a,"days");i=E.dayToPosition(r,e.nowposition||0,o||0)}return{left:i,width:n}},l=(t,s,o)=>{let l={top:[],middle:[],bottom:[],background:[]},d={},h="",p="",u="",g=null,f=null,k=e.currentday,w=(e.currentday||0)+(e.numVisibleDays||0);for(let e=(k||0)-30;e<w+30;e++)if(g=m().add(e,"days"),h!=g.format(i(t,"top"))&&(h=g.format(i(t,"top")),f=a(g,t,d.top),d.top=f.left+f.width,l.top.push(c.createElement(S,{key:e,left:f.left,width:f.width,label:h}))),p!=g.format(i(s))&&(p=g.format(i(s)),f=a(g,s,d.middle),d.middle=f.left+f.width,l.middle.push(c.createElement(S,{key:e,left:f.left,width:f.width,label:p}))),u!=g.format(i(o)))if(u=g.format(i(o)),f=a(g,o,d.bottom),d.bottom=f.left+f.width,"shorttime"==o||"fulltime"==o){let t=Array.apply(null,Array(24)).map((function(){})).map(((t,s)=>c.createElement(C,{key:`tile-${e}-${s}`,background:s%2==0?"#5d9634":"#538c2b",left:f.left+f.width/24*s,width:f.width/24})));l.background.push(t),l.bottom.push(n(f.left,f.width,o,e))}else l.background.push(c.createElement(C,{key:`tile-${e}`,left:f.left,width:f.width,background:e%2==0?"#5d9634":"#538c2b"})),l.bottom.push(c.createElement(S,{key:e,left:f.left,width:f.width,label:u}));return c.createElement("div",{className:"timeLine-main-header-container",style:{width:5e3,maxWidth:5e3}},c.createElement("div",{className:"header-top",style:r({},v.values.header.top.style)},l.top),c.createElement("div",{className:"header-middle",style:r({},v.values.header.middle.style)},l.middle),c.createElement("div",{className:"header-bottom",style:r({},v.values.header.bottom.style)},l.bottom),c.createElement("div",{className:"header-bottom",style:r({height:"100%"},v.values.header.bottom.style)},l.background))};return t.current&&(t.current.scrollLeft=e.scrollLeft||0),c.createElement("div",{id:"timeline-header",ref:t,className:"timeLine-main-header-viewPort"},(()=>{switch(s||e.mode){case"day":return l("week","dayweek","fulltime");case"week":return l("month","week","dayweek");case"month":return l("month","dayweek","daymonth");case"year":return l("year","month","week")}})())};class L extends h.exports.Component{constructor(e){super(e),this.onCreateLinkMouseDown=(e,t)=>{var s,o;0===e.button&&(e.stopPropagation(),null==(o=(s=this.props).onStartCreateLink)||o.call(s,this.props.item,t))},this.onCreateLinkMouseUp=(e,t)=>{e.stopPropagation(),this.props.onFinishCreateLink(this.props.item,t)},this.onCreateLinkTouchStart=(e,t)=>{var s,o;e.stopPropagation(),null==(o=(s=this.props).onStartCreateLink)||o.call(s,this.props.item,t)},this.onCreateLinkTouchEnd=(e,t)=>{e.stopPropagation(),this.props.onFinishCreateLink(this.props.item,t)},this.doMouseDown=(e,t)=>{this.props.onUpdateTask&&0===e.button&&(e.stopPropagation(),this.dragStart(e.clientX,t))},this.doMouseMove=e=>{this.state.dragging&&(e.stopPropagation(),this.dragProcess(e.clientX))},this.doMouseUp=()=>{this.dragEnd()},this.doTouchStart=(e,t)=>{this.props.onUpdateTask&&(console.log("start"),e.stopPropagation(),this.dragStart(e.touches[0].clientX,t))},this.doTouchMove=e=>{this.state.dragging&&(console.log("move"),e.stopPropagation(),this.dragProcess(e.changedTouches[0].clientX))},this.doTouchEnd=e=>{console.log("end"),this.dragEnd()},this.calculateStyle=this.calculateStyle.bind(this),this.state={dragging:!1,left:this.props.left||0,width:this.props.width||0,mode:0}}componentDidUpdate(e,t){this.state.dragging&&!t.dragging?(document.addEventListener("mousemove",this.doMouseMove),document.addEventListener("mouseup",this.doMouseUp),document.addEventListener("touchmove",this.doTouchMove),document.addEventListener("touchend",this.doTouchEnd)):!this.state.dragging&&t.dragging&&(document.removeEventListener("mousemove",this.doMouseMove),document.removeEventListener("mouseup",this.doMouseUp),document.removeEventListener("touchmove",this.doTouchMove),document.removeEventListener("touchend",this.doTouchEnd))}updatePosition(){let e=E.pixelToDate(this.state.left,this.props.nowposition,this.props.dayWidth||0),t=E.pixelToDate(this.state.left+this.state.width,this.props.nowposition,this.props.dayWidth||0);this.props.onUpdateTask(this.props.item,{start:e,end:t})}dragStart(e,t){this.props.onChildDrag(!0),this.draggingPosition=e,this.setState({dragging:!0,mode:t,left:this.props.left||0,width:this.props.width||0})}dragProcess(e){let t=this.draggingPosition-e,s=this.state.left,o=this.state.width;switch(this.state.mode){case 1:s=this.state.left-t;break;case 2:s=this.state.left-t,o=this.state.width+t;break;case 3:o=this.state.width-t}let i={item:this.props.item,position:{start:s-this.props.nowposition,end:s+o-this.props.nowposition}};this.updatePosition(),this.props.onTaskChanging(i),this.setState({left:s,width:o}),this.draggingPosition=e}dragEnd(){this.props.onChildDrag(!1),this.updatePosition(),this.setState({dragging:!1,mode:0})}calculateStyle(){let e=this.props.isSelected?v.values.dataViewPort.task.selectedStyle:v.values.dataViewPort.task.style,t=this.props.color?this.props.color:e.backgroundColor;return this.state.dragging?l(r({},e),{backgroundColor:t,left:this.state.left,width:this.state.width,height:this.props.height-5}):l(r({},e),{backgroundColor:t,left:this.props.left,width:this.props.width,height:this.props.height-5})}render(){let e=this.calculateStyle();return c.createElement(g,{focusIndicator:!1,elevation:"medium",onMouseDown:e=>this.doMouseDown(e,1),onTouchStart:e=>this.doTouchStart(e,1),onClick:e=>{this.props.onSelectItem(this.props.item)},style:l(r({},e),{top:3})},c.createElement("div",{className:"timeLine-main-data-task-side",style:{top:0,left:-4,height:e.height},onMouseDown:e=>this.doMouseDown(e,2),onTouchStart:e=>this.doTouchStart(e,2)},c.createElement("div",{className:"timeLine-main-data-task-side-linker",onMouseUp:e=>this.onCreateLinkMouseUp(e,"LINK_POS_LEFT"),onTouchEnd:e=>this.onCreateLinkTouchEnd(e,"LINK_POS_LEFT")})),c.createElement("div",{style:{overflow:"hidden"}},v.values.dataViewPort.task.showLabel?this.props.item.name:""),c.createElement("div",{className:"timeLine-main-data-task-side",style:{top:0,left:e.width-3,height:e.height},onMouseDown:e=>this.doMouseDown(e,3),onTouchStart:e=>this.doTouchStart(e,3)},c.createElement("div",{className:"timeLine-main-data-task-side-linker",onMouseDown:e=>this.onCreateLinkMouseDown(e,"LINK_POS_RIGHT"),onTouchStart:e=>this.onCreateLinkTouchStart(e,"LINK_POS_RIGHT")})))}}class M extends h.exports.Component{constructor(e){super(e)}render(){return c.createElement(g,{className:"timeLine-main-data-row",style:l(r({},v.values.dataViewPort.rows.style),{top:this.props.top,height:this.props.itemheight,borderBottom:"2px dashed #d3d3d350",strokeDasharray:1e3,strokeDashoffset:1e3})},this.props.children)}}const D=e=>{switch(e){case"year":return 7;case"month":case"week":return 1;case"day":return 1/24;default:return 1}},I=e=>{switch(e){case"year":return"12px";default:return 0}},N=e=>{switch(e){case"day":return 792;case"week":case"month":return 28;case"year":return 4;default:return 28}},P=d((e=>{var t;const s=h.exports.useRef(null),{mode:o,style:i,dayWidth:n,moveTimeline:a,scrollLeft:r}=h.exports.useContext(b),[l,d]=h.exports.useState(!1),[p,u]=f((t=>{var s;let o={width:(null==t?void 0:t.clientWidth)||null,height:(null==t?void 0:t.clientHeight)||null};return o.width&&o.height&&(null==(s=e.onSize)||s.call(e,o)),o})),m=e=>{d(e)};return h.exports.useEffect((()=>{s.current&&(s.current.scrollLeft=0)}),[]),h.exports.useEffect((()=>{s.current&&(s.current.scrollLeft=e.scrollLeft,s.current.scrollTop=e.scrollTop)}),[e.scrollLeft,e.scrollTop]),o&&(null==i?void 0:i.background)?null==(t=null==i?void 0:i.background)||t.call(i,o,n||0):(D(e.mode||"month"),I(e.mode||"month")),!(e.data.length>0)||e.itemheight,c.createElement("div",{ref:s,id:"timeLinedataViewPort",className:`${e.className} timeLine-main-data-viewPort`,onWheel:e=>{null==a||a((r||0)+e.deltaX)},onMouseDown:t=>{0!==t.button||l||e.onMouseDown(t)},onMouseMove:t=>{e.onMouseMove(t,s.current)},onMouseUp:e.onMouseUp,onMouseLeave:e.onMouseLeave,onTouchStart:t=>{l||e.onTouchStart(t)},onTouchMove:t=>{e.onTouchMove(t,s.current)},onTouchEnd:e.onTouchEnd,onTouchCancel:e.onTouchCancel},p,c.createElement("div",{className:"timeLine-main-data-container",style:{background:"transparent",height:"100%",width:5e3,maxWidth:5e3}},(()=>{let t=[];for(let s=e.startRow;s<e.endRow+1;s++){let o=e.data[s];if(!o)break;let i=E.dateToPixel(o.start,e.nowposition,n||0),a=E.dateToPixel(o.end,e.nowposition,n||0)-i;t.push(c.createElement(M,{isSelected:e.selectedItem==o,key:s,label:o.name,top:s*(e.itemheight+5),left:20,itemheight:e.itemheight+5},c.createElement(L,{item:o,label:o.name,nowposition:e.nowposition,dayWidth:n,color:o.color,left:i,width:a,height:e.itemheight,onChildDrag:m,isSelected:e.selectedItem==o,onSelectItem:e.onSelectItem,onStartCreateLink:e.onStartCreateLink,onFinishCreateLink:e.onFinishCreateLink,onTaskChanging:e.onTaskChanging,onUpdateTask:e.onUpdateTask}," ")))}return t})()))}))`
.timeLine-main-data-container{
  background: ;
  }

`;class $ extends h.exports.Component{constructor(e){super(e),this.calcNormCoordinates=()=>{let e={x:0,y:0},t={x:0,y:0},s=0;return s=this.props.start.x+(this.props.end.x-this.props.start.x)/2,e={x:s,y:this.props.start.y},t={x:s,y:this.props.end.y},{cpt1:e,cpt2:t}},this.calcSCoordinates=()=>{let e={x:this.props.start.x+20,y:this.props.start.y},t=(this.props.end.y-this.props.start.y)/2,s={x:e.x,y:e.y+t},o={x:this.props.end.x-20,y:s.y};return{cpt1:e,cpt2:s,cpt3:o,cpt4:{x:o.x,y:o.y+t}}},this.getPath=e=>{let t=null;return this.props.start.x>this.props.end.x?(t=this.calcSCoordinates(),`M${this.props.start.x} ${this.props.start.y}  ${t.cpt1.x} ${t.cpt1.y} ${t.cpt2.x} ${t.cpt2.y} ${t.cpt3.x} ${t.cpt3.y} ${t.cpt4.x} ${t.cpt4.y} ${this.props.end.x} ${this.props.end.y}`):(t=this.calcNormCoordinates(),`M${this.props.start.x} ${this.props.start.y}  ${t.cpt1.x} ${t.cpt1.y} ${t.cpt2.x} ${t.cpt2.y} ${this.props.end.x} ${this.props.end.y}`)},this.onSelect=e=>{this.props.onSelectItem&&this.props.onSelectItem(this.props.item)}}render(){let e=this.props.isSelected?v.values.links.selectedColor:v.values.links.color;return c.createElement("g",{className:"timeline-link"},c.createElement("path",{pointerEvents:"stroke",onMouseDown:this.onSelect,stroke:"white",d:this.getPath(),strokeLinejoin:"round",fill:"transparent",strokeWidth:"4",cursor:"pointer"}),c.createElement("path",{pointerEvents:"stroke",onMouseDown:this.onSelect,stroke:e,d:this.getPath(),strokeLinejoin:"round",fill:"transparent",strokeWidth:"1",cursor:"pointer",markerEnd:"url(#arrow)"}))}}class U extends h.exports.Component{constructor(e){super(e),this.doMouseMove=e=>{this.init||(this.lastX=e.clientX,this.lastY=e.clientY,this.init=!0);let t=this.state.x+(e.clientX-this.lastX),s=this.state.y+(e.clientY-this.lastY);this.lastX=e.clientX,this.lastY=e.clientY,this.setState({x:t,y:s})},this.doMouseUp=e=>{this.props.onFinishCreateLink()},this.state={x:this.props.start.x,y:this.props.start.y},this.init=!1,this.lastX=-1,this.lastY=-1}componentDidMount(){document.addEventListener("mousemove",this.doMouseMove),document.addEventListener("mouseup",this.doMouseUp)}componentWillUnmount(){document.removeEventListener("mousemove",this.doMouseMove),document.removeEventListener("mouseup",this.doMouseUp)}render(){return c.createElement($,{key:-1,start:{x:this.props.start.x,y:this.props.start.y},end:{x:this.state.x,y:this.state.y}})}}const R=e=>{var t,s,o,i;const n=(e=>{const{data:t}=h.exports.useContext(b);return null==t?void 0:t.map(((e,t)=>l(r({},e),{index:t}))).find((t=>t.id==e))})((null==(s=null==(t=e.taskToCreate)?void 0:t.task)?void 0:s.id)||"");(e=>{const{links:t}=h.exports.useContext(b);console.log(t,e),null==t||t.map(((e,t)=>l(r({},e),{index:t}))).find((t=>t.id==e))})(null==(i=null==(o=e.taskToCreate)?void 0:o.task)?void 0:i.id);const a=(()=>{const{links:e}=h.exports.useContext(b);return null==e?void 0:e.map(((e,t)=>l(r({},e),{index:t})))})(),{data:d,dayWidth:p}=h.exports.useContext(b);h.exports.useState(null),h.exports.useState(),h.exports.useState([]);const u=(t,s,o,i)=>{let n=m(t.index,t.end),a=m(s.index,s.start);return c.createElement($,{key:o.id,item:o,start:{x:n.x,y:n.y},end:{x:a.x,y:a.y},isSelected:e.selectedItem==o,onSelectItem:e.onSelectItem})},m=(t,s)=>{let o=(e.itemheight||0)+5;return{x:E.dateToPixel(s,0,p||0),y:t*o+o/2}};return c.createElement("svg",{x:0,y:0,width:"100%",pointerEvents:"none",style:{position:"absolute",top:0,userSelect:"none",height:"100%"}},c.createElement("defs",null,c.createElement("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"5",refY:"5",markerWidth:"9",markerHeight:"9",orient:"auto-start-reverse"},c.createElement("path",{d:"M 0 0 L 10 5 L 0 10 z",strokeLinejoin:"round"}))),c.createElement("g",{transform:`matrix(1,0,0,1,${-((e.scrollLeft||0)-(e.nowposition||0))},${-(e.scrollTop||0)})`},(()=>{let e=[],t={},s={};if(0!=(null==d?void 0:d.length)){for(let o=0;o<(a||[]).length;o++){let i=null==a?void 0:a[o];if(!i)return;t=null==d?void 0:d.find((e=>e.id==(null==i?void 0:i.source))),t&&(s=null==d?void 0:d.find((e=>e.id==(null==i?void 0:i.target))),s&&(e=e.concat([u(t,s,i)])))}return e}})(),(()=>{var t;if(e.interactiveMode&&(null==(t=e.taskToCreate)?void 0:t.task.id)){if(!n)return console.error("No link");let t=m(null==n?void 0:n.index,null==n?void 0:n.end);return c.createElement(U,{start:t,onFinishCreateLink:e.onFinishCreateLink})}})()))};class O extends h.exports.Component{constructor(e){super(e),this.textInput=c.createRef(),this.onFocus=()=>{this.setState({editing:!0})},this.onBlur=()=>{this.finishEditing()},this.handleKey=e=>{13===(e.keyCode||e.which)&&this.finishEditing()},this.finishEditing=()=>{this.isFocus=!1,this.setState({editing:!1}),this.props.onChange&&this.props.onChange(this.state.value)},this.handleChange=e=>{this.setState({value:e.target.value})},this.renderDiv=()=>c.createElement("div",{tabIndex:this.props.index,onClick:this.onFocus,onFocus:this.onFocus,style:{width:"100%"}}," ",this.state.value),this.renderEditor=()=>c.createElement("input",{ref:this.textInput,onBlur:this.onBlur,style:{width:"100%",outlineColor:"black",outlineStyle:"oinset"},type:"text",name:"name",value:this.state.value,onKeyUp:this.handleKey,onChange:this.handleChange}),this.isFocus=!1,this.state={editing:!1,value:this.props.value}}componentDidUpdate(e,t){this.textInput.current&&!this.isFocus&&(this.textInput.current.focus(),this.isFocus=!0)}shouldComponentUpdate(e,t){return e.value!=this.props.value&&this.setState({value:e.value}),!0}render(){return this.state.editing?this.renderEditor():this.renderDiv()}}class z extends h.exports.Component{constructor(e){super(e),this.onChange=e=>{this.props.onUpdateTask&&this.props.onUpdateTask(this.props.item,{name:e})}}render(){return c.createElement(g,{direction:"row",align:"center",style:l(r({},v.values.taskList.task.style),{top:this.props.top,height:this.props.itemheight+5}),onClick:e=>this.props.onSelectItem(this.props.item)},c.createElement("div",{className:"color-dot",style:{width:12,height:12,borderRadius:12,marginRight:8,background:this.props.item.color}}),this.props.nonEditable?c.createElement(g,{tabIndex:this.props.index},this.props.label):c.createElement(O,{value:this.props.label,index:this.props.index,onChange:this.onChange}))}}class Y extends h.exports.Component{constructor(e){super(e),this.taskViewRef=c.createRef(),this.doScroll=()=>{this.taskViewRef.current&&this.props.onScroll(this.taskViewRef.current.scrollTop)}}getContainerStyle(e){return{height:e>0?e*this.props.itemheight:10}}renderTaskRow(e){let t=[];for(let s=this.props.startRow;s<this.props.endRow+1;s++){let o=e[s];if(!o)break;t.push(c.createElement(z,{key:s,index:s,item:o,label:o.name,top:s*(this.props.itemheight+5),itemheight:this.props.itemheight,isSelected:this.props.selectedItem==o,onUpdateTask:this.props.onUpdateTask,onSelectItem:this.props.onSelectItem,nonEditable:this.props.nonEditable}))}return t}render(){let e=this.props.data?this.props.data:[];return this.containerStyle=this.getContainerStyle(e.length),c.createElement(g,{className:"timeLine-side"},c.createElement(g,{height:"60px",background:"dark-2",elevation:"small",pad:"small",align:"center",justify:"center",direction:"row"},c.createElement("div",null,v.values.taskList.title.label)),c.createElement(g,{ref:this.taskViewRef,className:"timeLine-side-task-viewPort",onScroll:this.doScroll},c.createElement(g,{className:"timeLine-side-task-container",style:r({display:"flex",alignItems:"center",justifyContent:"center"},this.containerStyle)},this.renderTaskRow(e))))}}class F{constructor(){this.initialise=(e,t,s,o)=>{this.nowposition=s,this.daywidth=o,this.setLimits(e,t),this.loadDataHorizon()},this.setStartEnd=(e,t,s,o)=>{this.nowposition=s,this.daywidth=o,this.needData(e,t)&&(this.setLimits(e,t),this.loadDataHorizon())},this.needData=(e,t)=>e<this.lower_data_limit||t>this.upper_data_limit,this.setLimits=(e,t)=>{this.lower_limit=e-1e3,this.lower_data_limit=e-750,this.upper_limit=t+1e3,this.upper_data_limit=t+750},this.loadDataHorizon=()=>{let e=E.pixelToDate(this.lower_limit,this.nowposition,this.daywidth),t=E.pixelToDate(this.upper_limit,this.nowposition,this.daywidth);this.onHorizonChange(e,t)},this.lower_limit=0,this.upper_limit=0,this._dataToRender=[]}onHorizonChange(e,t){throw new Error("Method not implemented.")}}const X=e=>{const[t,s]=h.exports.useState(!1),[o,i]=h.exports.useState(0),[n,a]=h.exports.useState(24e3),[r,l]=h.exports.useState(0),[d,p]=h.exports.useState(0),[u,m]=h.exports.useState(),[f,w]=h.exports.useState(),[y,E]=h.exports.useState(40),[S,C]=h.exports.useState(60),[L,M]=h.exports.useState(0),[D,I]=h.exports.useState({width:200}),$=h.exports.useRef(N(e.mode||"month")),[U,O]=h.exports.useState(0),[z,X]=h.exports.useState(!1),[_,H]=h.exports.useState(e.mode?e.mode:"month"),[W,j]=h.exports.useState({width:1,height:1}),[V,B]=h.exports.useState(),[A,K]=h.exports.useState(),G=h.exports.useRef(new F),[q,J]=h.exports.useState(),[Q,Z]=h.exports.useState(),[ee,te]=h.exports.useState([]),[se,oe]=h.exports.useState([]);h.exports.useEffect((()=>{G.current.onHorizonChange=le,v.load(e.config),G.current.initialise(d+L,d+L+W.width,L,$.current)}),[]);const ie=(t,s,o)=>{let i=Math.trunc(o/(e.itemheight||0));return{start:i,end:i+t>=s.length?s.length:i+t}},ne=()=>{G.current.setStartEnd(d,d+W.width,L,$.current)},ae=t=>{var s,o;let i=L,a=-1,l=u,d=f;t>n?(i=L-n-0,a=0):t<=0?(i=L+n+14,a=n):a=t;let h=Math.trunc((t-L)/$.current);l=Math.trunc(r/(e.itemheight||0)),d=l+y>=(e.data||[]).length?(e.data||[]).length-1:l+y,ne(),O(h);let c=new Date,g=e.date;c.setHours(0,0,0,0),null==g||g.setHours(0,0,0,0),c.setDate(c.getDate()+h),(null==(s=e.date)?void 0:s.getTime())!=c.getTime()&&(null==(o=e.onDateChange)||o.call(e,c)),M(i),Z(Q),p(a),m(l),w(d)},re=e=>{a(5e3*(1-e.width/5e3)-1)},le=(t,s)=>{e.onHorizonChange&&e.onHorizonChange(t,s)},de=t=>{e.onSelectItem&&t!=e.selectedItem&&e.onSelectItem(t)},he=(t,s)=>{if(console.log("End Link",t,V,e.onCreateLink),e.onCreateLink&&t&&V&&V.task.id!=t.id){let o={id:k(),source:V.task.id,sourceHandle:V.position,target:t.id,targetHandle:s};console.log("New link",o),e.onCreateLink(o)}X(!1),B(void 0)},ce=(e,t)=>(console.log(e,t||$),Math.ceil(e.width/(t||$.current))+30),pe=e=>{if(console.log("Change mode",e),e!=_){let t=N(e),s=Math.ceil(-U*t/n),o=(U*t+L)%n;console.log(e,t),H(e),$.current=t,C(ce(W,t)),M(s*n),p(o)}};return h.exports.useEffect((()=>{e.data&&te(e.data)}),[e.data]),h.exports.useEffect((()=>{e.links&&oe(e.links)}),[e.links]),h.exports.useEffect((()=>{e.mode&&pe(e.mode)}),[e.mode]),console.log(ee),c.createElement(b.Provider,{value:{data:ee,links:se,style:e.style,mode:_,scrollLeft:d,moveTimeline:ae,changeMode:pe,dayWidth:$.current}},c.createElement("div",{className:"timeLine",style:{position:"relative",flex:1}},c.createElement("div",{className:"timeLine-side-main",style:D},c.createElement(Y,{itemheight:e.itemheight,startRow:u,endRow:f,data:e.data,selectedItem:e.selectedItem,onSelectItem:de,onUpdateTask:e.onUpdateTask,onScroll:t=>{if(t==t)return;let s=ie(y,e.data||[],t);s.start!==u&&(l(t),m(s.start),w(s.end))},nonEditable:e.nonEditableName}),c.createElement(x,{onTaskListSizing:e=>{I({width:e})}})),c.createElement("div",{className:"timeLine-main"},c.createElement(g,{style:{position:"absolute",height:"100%",width:"100%",top:0,left:0},className:"header-container"},c.createElement(T,{headerData:Q,numVisibleDays:S,currentday:U,nowposition:L,scrollLeft:d})),c.createElement(g,{style:{position:"absolute",width:"100%",height:"calc(100% - 60px)",zIndex:9,top:60,left:0}},c.createElement(P,{scrollLeft:d,scrollTop:r,itemheight:e.itemheight,nowposition:L,startRow:u,endRow:f,data:e.data,selectedItem:e.selectedItem,onScroll:q,onMouseDown:e=>{s(!0),i(e.clientX)},onMouseMove:e=>{if(t){let t=o-e.clientX;0!==t&&(i(e.clientX),ae(d+t))}},onMouseUp:e=>{s(!1)},onMouseLeave:e=>{s(!1)},onTouchStart:e=>{s(!0),i(e.touches[0].clientX)},onTouchMove:e=>{if(t){let t=o-e.touches[0].clientX;0!==t&&(i(e.touches[0].clientX),ae(d+t))}},onTouchEnd:e=>{s(!1)},onTouchCancel:e=>{s(!1)},onSelectItem:de,onUpdateTask:e.onUpdateTask,onTaskChanging:e=>{console.log("Changing task",e),K(e)},onStartCreateLink:(e,t)=>{console.log("=> Start Link",e,t),X(!0),B({task:e,position:t})},onFinishCreateLink:he,boundaries:{lower:d,upper:d+W.width},onSize:t=>{console.log(t,$),re(t),ne();let s=Math.ceil(t.height/(e.itemheight||0)),o=ce(t,$.current),i=ie(s,e.data||[],r);C(o),console.log("DAYS",o),E(s),m(i.start),w(i.end),j(t)}}),c.createElement(R,{scrollLeft:d,scrollTop:r,startRow:u,endRow:f,data:e.data||[],nowposition:L,interactiveMode:z,taskToCreate:V,onFinishCreateLink:he,changingTask:A,selectedItem:e.selectedItem,onSelectItem:de,itemheight:e.itemheight,links:e.links||[]})))))},_=e=>{const{mode:t,changeMode:s}=h.exports.useContext(b),o=t=>{var o;null==s||s(t),null==(o=e.onChange)||o.call(e,t)},i=e=>t==e?{backgroundColor:"grey",boder:"solid 1px #223344"}:{};return c.createElement("div",{className:"mode-container"},c.createElement("div",{className:"mode-container-item mode-container-item-left",onClick:e=>null==o?void 0:o("day"),style:i("day")},"Day"),c.createElement("div",{className:"mode-container-item",onClick:e=>null==o?void 0:o("week"),style:i("week")},"Week"),c.createElement("div",{className:"mode-container-item",onClick:e=>null==o?void 0:o("month"),style:i("month")},"Month"),c.createElement("div",{className:"mode-container-item mode-container-item-right",onClick:e=>null==o?void 0:o("year"),style:i("year")},"Year"))};const H=[{id:1,color:"purple",name:"Test",start:new Date(2021,2,12),end:new Date(2021,5,9)},{id:2,color:"orange",name:"Test",start:new Date(2021,7,12),end:new Date(2021,12,9)}];class W extends h.exports.Component{constructor(e){super(e),this.handleDayWidth=e=>{this.setState({daysWidth:parseInt(e.target.value)})},this.handleItemHeight=e=>{this.setState({itemheight:parseInt(e.target.value)})},this.onHorizonChange=(e,t)=>{let s=H.filter((s=>s.start<e&&s.end>t||s.start>e&&s.start<t||s.end>e&&s.end<t));console.log("Calculating "),this.setState({data:s})},this.onSelectItem=e=>{console.log(`Select Item ${e}`),this.setState({selectedItem:e})},this.onUpdateTask=(e,t)=>{e.start=t.start,e.end=t.end,this.setState({data:[...this.state.data]}),console.log(`Update Item ${e}`)},this.onCreateLink=e=>{this.setState({links:[...this.state.links,e]}),console.log(`Update Item ${e}`)},this.modeChange=e=>{this.setState({timelineMode:e})},this.addTask=()=>{let e={id:this.state.data.length+1,start:new Date,end:this.getRandomDate(),name:"New Task",color:this.getRandomColor()};this.setState({data:[e,...this.state.data]})},this.delete=()=>{if(console.log("On delete"),this.state.selectedItem){let e=this.state.links.indexOf(this.state.selectedItem);e>-1&&(this.state.links.splice(e,1),this.setState({links:[...this.state.links]})),e=this.state.data.indexOf(this.state.selectedItem),e>-1&&(this.state.data.splice(e,1),this.setState({data:[...this.state.data]}))}},this.state={itemheight:50,data:H,selectedItem:null,timelineMode:"month",links:[],nonEditableName:!1,date:new Date}}getbuttonStyle(e){return this.state.timelineMode==e?{backgroundColor:"grey",boder:"solid 1px #223344"}:{}}getRandomDate(){let e=new Date;return e.setDate(e.getDate()+10*Math.random()),e}getRandomColor(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}getStripes(e,t){let s=[];for(var o=0;o<e;o++){let i=0==o||o==e-1?"#5d9634":"#538c2b";s.push(`\n        ${0==o?`#ffffff ${o*t}px,\n        #ffffff ${o*t+.5}px,`:""}\n        ${i} ${o*t+.5}px,\n        ${i} ${o*t+t}px\n        , #ffffff ${o*t}px,\n        #ffffff ${o*t+.5}px`)}return s.join(",")}getOffset(e){switch(e){case"year":return 4;default:return 0}}handleDateChange(e){this.setState({date:e}),console.log("Date",e)}render(){return c.createElement("div",{className:"app-container"},c.createElement("div",{className:"nav-container"},c.createElement("div",{className:"mode-container-title"},"Full Demo"),c.createElement("div",{className:"operation-button-container"},c.createElement("div",{className:"operation-button-container"},c.createElement("div",{className:"mode-button",onClick:this.addTask},c.createElement("svg",{height:30,width:30,viewBox:"0 0 48 48"},c.createElement("path",{fill:"silver",d:"M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 22h-8v8h-4v-8h-8v-4h8v-8h4v8h8v4z"}))),c.createElement("div",{className:"mode-button",onClick:this.delete},c.createElement("svg",{height:30,width:30,viewBox:"0 0 48 48"},c.createElement("path",{fill:"silver",d:"M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 22H14v-4h20v4z"}))))),c.createElement(_,{onChange:e=>this.setState({timelineMode:e})})),c.createElement("div",{className:"time-line-container"},c.createElement(X,{style:{background:(e,t)=>("year"==e&&(t*=7),{background:`linear-gradient(\n                  to right, \n                  ${this.getStripes(2,t)}\n                )`,backgroundSize:2*t+"px 100%",backgroundPosition:`${this.getOffset(e)}px 0`})},data:this.state.data,date:this.state.date,onDateChange:this.handleDateChange.bind(this),links:this.state.links,onHorizonChange:this.onHorizonChange,onSelectItem:this.onSelectItem,onUpdateTask:this.onUpdateTask,onCreateLink:this.onCreateLink,mode:this.state.timelineMode,itemheight:this.state.itemheight,selectedItem:this.state.selectedItem,nonEditableName:this.state.nonEditableName})))}}w.render(c.createElement(c.StrictMode,null,c.createElement(W,null)),document.getElementById("root"));
